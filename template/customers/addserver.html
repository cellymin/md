<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>苗博士_增加客户资料</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="{$Think.const.STATIC_URL}lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="{$Think.const.STATIC_URL}lib/font-awesome/css/font-awesome.css">
    <script src="{$Think.const.STATIC_URL}lib/jquery-1.11.1.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}theme.css">
    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}premium.css">
    <script src="{$Think.const.STATIC_URL}layer/layer.js"></script>

    <script src="{$Think.const.STATIC_URL}plugins/cover_js/iscroll-zoom.js" type="text/javascript" charset="utf-8"></script>
    <script src="{$Think.const.STATIC_URL}plugins/cover_js/hammer.js" type="text/javascript" charset="utf-8"></script>
    <script src="{$Think.const.STATIC_URL}plugins/cover_js/lrz.all.bundle.js" type="text/javascript" charset="utf-8"></script>
    <script src="{$Think.const.STATIC_URL}plugins/cover_js/jquery.photoClip.min.js" type="text/javascript"
            charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}server.css">
</head>
<body>

{include file="template/sidebar.html"}
<div class="content" id="ddd" style="">
    {include file="template/navbar.html"}
    <div class="base_base mbs_header">
        <!--        <p class="mbs_title">祛斑跟踪表</p>-->
        <p class="mbs_no" attruid="{$cusinfo.id}" >
            编号：<span>{$user_no}</span>
        </p>
    </div>
    <div class="base_base base_info">
        <p>一、基本资料</p>
        <div class="base_left">
            <span><em>姓名：</em><input style="width: 100px" type="text" name="name" id="user_name" value="{$cusinfo.name}"
                                     readonly></span>
            <span><em>性别：</em>
                <input style="text-align: center" type="text" name="name" id="user_sex"
                       {if condition="(isset($cusinfo) && $cusinfo.sex == 1)" } value="男" readonly
                       {elseif condition="$cusinfo.sex == 2"/} value="女" readonly {/if} ></span>
            <p>
             <span><em>出生日期：</em>
              <input style="width: 54px;text-align: center" type="text" name="name" id="user_birth_y"
                     value="{$cusinfo.birth|substr=0,4}" readonly><em>年</em>
              <input style="text-align: center" type="text" name="name" id="user_birth_m"
                     value="{$cusinfo.birth|substr=5,2}" readonly><em>月</em>
              <input style="text-align: center" type="text" name="name" id="user_birth_d"
                     value="{$cusinfo.birth|substr=8,2}" readonly><em>日</em>
        </span>
            </p>

            <p class="base_phone">联系方式：<input type="text" name="phone" id="user_phone" value="{$cusinfo.phone}"
                                              readonly></p>
            <p class="base_phone">联系地址：<input type="text" name="phone" id="user_address" value="{$cusinfo.address}"
                                              readonly></p>
            <span class="base_job">职业：<input type="text" name="user_job" id="user_job"></span>
            <p><span class="if_marry">婚否：
                <label><input type="radio" name="is_marry" value="1">是</label>
                <label><input type="radio" name="is_marry" value="2">否</label>
            </span>
            </p>
        </div>
        <div class="base_right">
            <div style="min-height:1px;position:relative;" ontouchstart="">
                <div class="cover-wrap" style="">
                    <div class="cece" style="">
                        <div id="clipArea" style=""></div>
                        <div class="cece_1" style="">
                            <button id="clipBtn" style="">保存封面</button>
                        </div>
                    </div>
                </div>
                <div id="view" style="" title="请上传 198*172 的头像"></div>
                <div style="height:10px;"></div>
                <div class="cece_2" style=" ">
                    <input type="file" id="file" style="">
                </div>
            </div>
        </div>
    </div>
    <div class="base_base skin_des">
        <p>二、皮肤综合分析</p>
        <div class="pifu_base">
            <div class="pifu_left">
                <table class="fu_select">
                    <tr class="skin_cate">
                        <td class="skin_title">皮肤类型</td>
                        <td class="skin_select">
                            <label><input type="checkbox" name="skin_cate" value="中性"><em>中性</em></label>
                            <label><input type="checkbox" name="skin_cate" value="干性"><em>干性</em></label>
                            <label><input type="checkbox" name="skin_cate" value="油性"><em>油性</em></label>
                            <label><input type="checkbox" name="skin_cate" value="混合性"><em>混合性</em></label>
                            <label><input type="checkbox" name="skin_cate" value="暗疮性"><em>暗疮性</em></label>
                            <label><input type="checkbox" name="skin_cate" value="敏感性"><em>敏感性</em></label>
                        </td>
                    </tr>
                    <tr class="health_info">
                        <td class="skin_title">身体情况</td>
                        <td class="skin_select">
                            <label><input type="checkbox" name="health_info" value="高血压"><em>高血压</em></label>
                            <label><input type="checkbox" name="health_info" value="心脏病"><em>心脏病</em></label>
                            <label><input type="checkbox" name="health_info" value="糖尿病"><em>糖尿病</em></label>
                            <label><input type="checkbox" name="health_info" value="疤痕体质"><em>疤痕体质</em></label>
                            <label><input type="checkbox" name="health_info" value="白癜风"><em>白癜风</em></label>
                            <label><input type="checkbox" name="health_info" value="妊娠期/哺乳期"><em>妊娠期/哺乳期</em></label>
                            <label><input type="checkbox" name="health_info"
                                          value="甲状腺功能亢进或低下"><em>甲状腺功能亢进或低下</em></label>
                            <label><input type="checkbox" name="health_info" value="肝肾功能疾病"><em>肝肾功能疾病</em></label>
                        </td>
                    </tr>
                    <tr class="experience">
                        <td class="skin_title">祛斑经历</td>
                        <td class="skin_select">
                            <label><input type="checkbox" name="freckle_experience" value="雀斑"><em>E&nbsp;光</em></label>
                            <label><input type="checkbox" name="freckle_experience" value="黄褐斑"><em>彩光</em></label>
                            <label><input type="checkbox" name="freckle_experience" value="真皮斑"><em>激光</em></label>
                            <label><input type="checkbox" name="freckle_experience" value="老年斑"><em>磁波</em></label>
                            <label><input type="checkbox" name="freckle_experience" value="黑痣"><em>液氮</em></label>
                            <label><input type="checkbox" name="freckle_experience" value="粉刺"><em>点斑水</em></label>
                            <label><input type="checkbox" name="freckle_experience" value="痤疮"><em>点刺/火针</em></label>
                            <label><input type="checkbox" name="freckle_experience" value="汗管瘤"><em>换肤</em></label>
                            <label><input type="checkbox" name="freckle_experience" value="扁平疣"><em>外用祛斑霜</em></label>
                        </td>
                    </tr>
                    <tr class="stain_type">
                        <td class="skin_title">色斑类型</td>
                        <td class="skin_select">
                            <label><input type="checkbox" name="stains_cate" value="雀斑"><em>雀斑</em></label>
                            <label><input type="checkbox" name="stains_cate" value="黄褐斑"><em>黄褐斑</em></label>
                            <label><input type="checkbox" name="stains_cate" value="真皮斑"><em>真皮斑</em></label>
                            <label><input type="checkbox" name="stains_cate" value="老年斑"><em>老年斑</em></label>
                            <label><input type="checkbox" name="stains_cate" value="黑痣"><em>黑痣</em></label>
                            <label><input type="checkbox" name="stains_cate" value="粉刺"><em>粉刺</em></label>
                            <label><input type="checkbox" name="stains_cate" value="痤疮"><em>痤疮</em></label>
                            <label><input type="checkbox" name="stains_cate" value="汗管瘤"><em>汗管瘤</em></label>
                            <label><input type="checkbox" name="stains_cate" value="扁平疣"><em>扁平疣</em></label>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="pifu_right">
                <img src="{$Think.const.IMG_URL}addinfo.jpg">
            </div>
        </div>

        <p style="clear: both;padding-top:10px;font-size: 16px">
            <span>1.黄褐斑</span>
            <span>2.真皮斑</span>
            <span>3.老年斑</span>
            <span>4.黑痣</span>
            <span>5.雀斑</span>
            <span>6.胎记</span>
            <span>7.痘印</span>
            <span>8.其他斑种</span>
        </p>
        <p>*有以上症状请如实告知以免影响祛斑效果*</p>
    </div>
    <div class="base_base if_did">
        <p>三、曾否做过皮肤护理：
            <label><input type="radio" name="if_huli" value="1">是</label>
            <label><input type="radio" name="if_huli" value="2">否</label>
            <label><input type="radio" name="if_huli" value="3">定期</label>
        </p>
        <p>面部是否微整：
            <label><input type="radio" name="if_surgery" value="1" onclick="if_show(this);"> 是</label>
            <label><input type="radio" name="if_surgery" value="2" onclick="if_show(this);">否</label>
            <div class="sur_detail" style="display: none">
                详情告知：<input style="width: 220px;" class="surgery_detail" type="text" name="surgery_detail" value="" id="surgery_detail">
            </div>

        </p>
    </div>
    <div class="base_base solution">
        <p>四、祛斑方案：<input style="width: 250px" type="text" name="solution" class="ssolution" id="solution" value=""></p>
        <p><em>配增产品：</em><input style="width: 250px" type="text" name="use_product" class="use_product" id="use_product" value="">
        </p>
    </div>

    <div class="base_base service_record">
        <p>服务记录</p>
        <ul>
            <li style="width: 15%;text-align: center;">日期</li>
            <li style="width: 18%;text-align: center;">服务项目</li>
            <li style="width: 25%;text-align: center;">当天服务内容</li>
            <li style="width: 13%;text-align: center;">技师签名</li>
            <li style="width: 20%;text-align: center;">产品</li>
            <li style="width: 8%;text-align: center;font-size: 18px">操作</li>
        </ul>
        <!--        <ul>-->
        <!--            <li style="width: 10%;text-align: center;font-size: 16px">2020-09-17</li>-->
        <!--            <li style="width: 25%;text-align: center;overflow: hidden;font-size: 16px" onmouseover="show_all(this);">服务项目服务项目服务项目服务项目服务项目服务项目服务项目服务项目</li>-->
        <!--            <li style="width: 30%;text-align: center;overflow: hidden;font-size: 16px">当天服务内容服务项目服务项目服务项目服务项目服务项目服务项目</li>-->
        <!--            <li style="width: 10%;text-align: center;overflow: hidden;font-size: 16px">技师签名服务项目服务项目服务项目服务项目服务项目服务项目</li>-->
        <!--            <li style="width: 20%;text-align: center;overflow: hidden;font-size: 16px">产品服务项目服务项目服务项目服务项目</li>-->
        <!--            <li style="width: 5%;text-align: center;font-size: 16px">x</li>-->
        <!--        </ul>-->
        <ul class="info_sub">
            <li class="creat_time">{$create_time|date="Y-m-d",###}</li>
            <li class="server_demo"><input type="text" name="" onmouseover="this.title=this.value"></li>
            <li class="server_detail"><input type="text" name="" onmouseover="this.title=this.value"></li>
            <li class="server_sign"><img class="server_peo_ok" onclick="ser_peo_ok(this);" width="80" height="36"
                                         src=" "></li>
            <li class="server_pro"><input type="text" onmouseover="this.title=this.value"></li>
            <li class="cazuo"><span class="add_service" onclick="add_server(this);">+</span><span class="ok_service"
                                                                                                  onclick="confirm_server(this);">✔</span>
            </li>
        </ul>
        <script>
            function add_server(e) {
                var par = $(e).parent().parent().html();
                $(e).parent().parent().parent().children().last().after('<ul class="info_sub">' + par + '</ul>');
            }

            function show_all(e) {
                $(e).attr('title', $(e).text());
            }

            function confirm_server(e) {
                var time = $(e).parent().parent().find('.creat_time').text();
                var ser_demo = $(e).parent().parent().find('.server_demo input').val();
                var ser_detail = $(e).parent().parent().find('.server_detail input').val();
                var ser_sign = $(e).parent().parent().find('.server_sign img').attr('src');
                var ser_pro = $(e).parent().parent().find('.server_pro input').val();
                time = time.trim().replace(/\s/g, "");
                ser_demo = ser_demo.trim().replace(/\s/g, "");
                ser_detail = ser_detail.trim().replace(/\s/g, "");
                ser_sign = ser_sign.trim().replace(/\s/g, "");
                ser_pro = ser_pro.trim().replace(/\s/g, "");

                //服务项目
                var server_demo = $(e).parent().parent().find('.server_demo input').val().replace(/(^\s*)|(\s*$)/g, "");
                if(server_demo == 'null' ||  server_demo == undefined || server_demo == ""){
                    alert('服务项目不能为空！');
                    return false;
                }
                //服务内容
                var server_detail = $(e).parent().parent().find('.server_detail input').val().replace(/(^\s*)|(\s*$)/g, "");
                if(server_detail == 'null' ||  server_detail == undefined || server_detail == ""){
                    alert('服务内容不能为空！');
                    return false;
                }
                //技师签名
                var server_sign =  $(e).parent().parent().find('.server_sign img').attr('src').replace(/(^\s*)|(\s*$)/g, "");

                if(server_sign == 'null' ||  server_sign == undefined || server_sign == ""){
                    alert('技师签名不能为空！');
                    return false;
                }
                //产品
                var product = $(e).parent().parent().find('.server_pro input').val().replace(/(^\s*)|(\s*$)/g, "");
                if(product == 'null' ||  product == undefined || product == ""){
                    alert('产品不能为空！');
                    return false;
                }
                var if_input = $(e).parent().parent().parent().find('.info_sub').length;
                if (parseInt(if_input) > 1) {
                    $(e).parent().parent().remove();
                } else {
                    var ss = '<ul class="info_sub">\n' +
                        '            <li class="creat_time">{$create_time|date="Y-m-d",###}</li>\n' +
                        '            <li class="server_demo"><input type="text" name="" onmouseover="this.title=this.value"></li>\n' +
                        '            <li class="server_detail"><input type="text" name="" onmouseover="this.title=this.value"></li>\n' +
                        '            <li class="server_sign"><img class="server_peo_ok" onclick="ser_peo_ok(this);" width="80" height="36"\n' +
                        '                                         src=" "></li>\n' +
                        '            <li class="server_pro"><input type="text" onmouseover="this.title=this.value"></li>\n' +
                        '            <li class="cazuo"><span class="add_service" onclick="add_server(this);">+</span><span class="ok_service" onclick="confirm_server(this);">✔</span>\n' +
                        '            </li>\n' +
                        '        </ul>';
                    $(e).parent().parent().parent().children().last().after(ss);

                    $(e).parent().parent().remove();
                }
                var html = ' <ul class="confim_info">\n' +
                    '            <li class="time" style="width: 15%;text-align: center;font-size: 16px">' + time + '</li>\n' +
                    '            <li class="ser_demo" style="width: 18%;text-align: center;overflow: hidden;font-size: 16px" onmouseover="show_all(this);">' + ser_demo + '</li>\n' +
                    '            <li class="ser_detail" style="width: 25%;text-align: center;overflow: hidden;font-size: 16px" onmouseover="show_all(this);">' + ser_detail + '</li>\n' +
                    '            <li class="ser_sign" style="width: 13%;text-align: center;overflow: hidden;font-size: 16px" ><img class="server_peo_ok_conf" width="80" height="36"\n' +
                    '                                         src="' + ser_sign + ' "></li>\n' +
                    '            <li class="ser_pro" style="width: 20%;text-align: center;overflow: hidden;font-size: 16px" onmouseover="show_all(this);">' + ser_pro + '</li>\n' +
                    '            <li style="width: 8%;text-align: center;font-size: 16px"><span class="del_server" onclick="del_ser(this)";>x</span></li>\n' +
                    '        </ul>';
                $('.info_sub').eq(0).before(html);
            }

            function del_ser(e) {
                var if_input = $(e).parent().parent().parent().find('.info_sub').length;
                if (parseInt(if_input) > 0) {
                    $(e).parent().parent().remove();
                } else {
                    var ss = '<ul class="info_sub">\n' +
                        '            <li class="creat_time">{$create_time|date="Y-m-d",###}</li>\n' +
                        '            <li class="server_demo"><input type="text" name="" onmouseover="this.title=this.value"></li>\n' +
                        '            <li class="server_detail"><input type="text" name="" onmouseover="this.title=this.value"></li>\n' +
                        '            <li class="server_sign"><img class="server_peo_ok" onclick="ser_peo_ok(this);" width="80" height="36"\n' +
                        '                                         src=" "></li>\n' +
                        '            <li class="server_pro"><input type="text" onmouseover="this.title=this.value"></li>\n' +
                        '            <li class="cazuo"><span class="add_service" onclick="add_server(this);">+</span><span class="ok_service" onclick="confirm_server(this);">✔</span>\n' +
                        '            </li>\n' +
                        '        </ul>';
                    $(e).parent().parent().parent().children().last().after(ss);

                    $(e).parent().parent().remove();
                }
            }
        </script>
    </div>
    <div class="base_base sign" style="clear: both">
        <p class="customer_sign">
        <div class="customer_sign_start"><span>顾客确认：</span><img class="cus_sign_ok" width="80" height="50"
                                                                src=" ">
        </div>
        </p>
        <p class="dean_sign">
        <div class="dean_sign_start"><span>院长确认：</span><img class="dean_sign_ok" width="80" height="50"
                                                            src=" ">

        </div>
        </p>

        <p><span><em>接待人：</em><input style="width: 150px" type="text" name="reception" id="who_meet" readonly
                                     value="{$_SESSION['UNAME']}"></span>
            <span><em>咨询日期：</em><input style="width: 150px" type="text" name="wz_detail" id="when"
                                       value="{$create_time|date='Y-m-d',###}" readonly></span>
        </p>
        <p>
            <span style="position: relative"><em>分配技师：</em>
                <select style="width: 250px" class="search_select" id="selectInput" name="wz_detail" autocomplete="off">
                     {foreach $jsinfo as $k }
                    <option value="{$k.name}" dd="{$k.quanpin}" es="{$k.jianxie}" ss="{$k.id}" taxrate="">{$k.name}</option>
                    {/foreach}
                </select>
                </span>
        </p>
        <p class="source_from">
            <em>途径：</em>
          <label>{$cusinfo.source_from}</label>
        </p>
        <p class="submit_ok" onclick="confirm_sub(this)"><span>确认</span></p>
<!--        <input type="button" onclick="aa()" value="打印"/>-->

    </div>
</div>
<script language="javascript" src="{$Think.const.JS_URL}jquery.jqprint-0.3.js"></script>
<script>
    function aa(){
        $("#ddd").jqprint();
    }
    function ser_peo_ok(e) {
        $(e).addClass('select_ser');
        // console.log($(e).attr('class'));
        layer.open({
            type: 2,
            title: '签名',
            maxmin: true,
            area: ['500px', '400px'],
            content: '{$Think.const.SITEURL}/template/sign.html?sign=service'
        });

    }

    function if_show(e) {
        var attrval = parseInt($(e).val());
        // console.log(attrval);
        if (attrval == 1) {
            $('.sur_detail').css('display','block');
            // $(e).parent().parent().find('.surgery_detail').removeAttr('disabled');
        } else if (attrval == 2) {
            $('.sur_detail').css('display','none');
            // $(e).parent().parent().find('.surgery_detail').attr('disabled', 'disabled');
        }
    }

    $('.customer_sign_start .cus_sign_ok').on('click', function () {
        layer.open({
            type: 2,
            title: '签名',
            maxmin: true,
            area: ['500px', '400px'],
            content: '{$Think.const.SITEURL}/template/sign.html?sign=cus'
        });
    });
    $('.dean_sign_start .dean_sign_ok').on('click', function () {
        layer.open({
            type: 2,
            title: '签名',
            maxmin: true,
            area: ['500px', '400px'],
            content: '{$Think.const.SITEURL}/template/sign.html?sign=dean'
        });
    });


    function confirm_sub(e) {
        var customers = '';
        var addinfo = '';
        var cussrc ='';
        cussrc = $('#view').css("background-image").split("\"")[1];
        //
        var server_no = $('.mbs_no span').text().replace(/(^\s*)|(\s*$)/g, "");
        //客户信息延伸
        var customer_id = parseInt($('.mbs_no').attr('attruid'));
        var cus_job = $('#user_job').val().replace(/(^\s*)|(\s*$)/g, "");
        var is_marry = parseInt($('input[name="is_marry"]:checked').val());
        var if_huli = parseInt($('input[name="if_huli"]:checked').val());
        //是否微整
        var if_surgery = parseInt($('input[name="if_surgery"]:checked').val());
        //详情告知
        var sur_deyail = $('.surgery_detail').val().replace(/(^\s*)|(\s*$)/g, "");
        var solution = $('.ssolution').val().replace(/(^\s*)|(\s*$)/g, "");
        var use_product = $('.use_product').val().replace(/(^\s*)|(\s*$)/g, "");
        var customer_sign = $('.cus_sign_ok').attr('src').replace(/(^\s*)|(\s*$)/g, "");
        var dean_sign = $('.dean_sign_ok').attr('src').replace(/(^\s*)|(\s*$)/g, "");
        if(!customer_sign.length>1){
            alert('顾客签字不能为空！');
            return false;
        }
        var customer_name = $('#user_name').val().replace(/(^\s*)|(\s*$)/g, "");
        //技师名称
        var jishi = $('#selectInputClone').val().replace(/(^\s*)|(\s*$)/g, "");
        //技师id
        var jsid = parseInt($('.selectssss').val());

        if(customer_id>0){
            customers =  'customer_id*' + customer_id + ',';
        }else{
            alert('无效的客户信息！');
            return false;
        }
        if(jsid>0){
            customers = customers + 'server_id*'+jsid+',';
        }else{
            alert('请分配技师！');
            return false;
        }
        if(jishi != null && jishi != undefined && jishi != ""){
            customers = customers + 'server_name*'+jishi+',';
        }
        if(customer_name != null && customer_name != undefined && customer_name != ""){
            customers = customers + 'customer_name*'+customer_name+','
        }
        if(server_no != null && server_no != undefined && server_no != ""){
            customers = customers + 'server_no*'+server_no+','
        }else{
            alert('无效的单子！');
            return false;
        }

        if(is_marry>0){
            addinfo =  'cusismarry*' + is_marry + ',';
        }else{
            alert('请勾选是否已婚！');
            return false;
        }
        if(cus_job != null && cus_job != undefined && cus_job != ""){
            addinfo = addinfo + 'cusjob*'+cus_job+','
        }
        if(if_surgery>0){
            customers =  customers + 'micro_surgery*' + if_surgery + ',';
            if(if_surgery==1 && sur_deyail != null && sur_deyail != undefined && sur_deyail != ''){
                customers = customers + 'surgery_detail*'+sur_deyail+',';
            }
        }else{
            alert('请勾选是否微整！');
            return false;
        }

        if(if_huli>0){
            customers =  customers + 'done_skincare*' + if_huli + ','
        }else{
            alert('请勾选护理信息！');
            return falsep;
        }

        if(solution != null && solution != undefined && solution != ""){
            customers = customers + 'solution*'+solution+','
        }else{
            alert('请填写解决方案');
            return  false;
        }
        if(use_product != null && use_product != undefined && use_product != ""){
            customers = customers + 'product*'+use_product+','
        }else{
            alert('请填写产品');
            return false;
        }
        //客户状态评测信息
        var check_skin_cate = '';//皮肤类型
        var check_health = '';//身体状况 health_info
        var check_freckle_experience = '';//祛斑经历 freckle_experience
        var check_stains_cate = '';//色斑类型 stains_cate

        //皮肤类型
        $("input[name='skin_cate']:checked").each(function (i) {
            var my_val = $(this).val();
            if (my_val == null || my_val == undefined || my_val == "") {
                alert('你未选择皮肤类型，请选择！')
                return false;
            } else {
                if (check_skin_cate.length > 0) {
                    check_skin_cate = check_skin_cate + ',' + my_val;
                } else {
                    check_skin_cate = my_val;
                }
            }
        });
        //身体状况
        $("input[name='health_info']:checked").each(function (i) {
            var health_val = $(this).val();
            if (health_val == null || health_val == undefined || health_val == "") {
                alert('你未选择身体状况，请选择！')
                return false;
            } else {
                if (check_health.length > 0) {
                    check_health = check_health + ',' + health_val;
                } else {
                    check_health = health_val;
                }
            }
        });
        //祛斑经历
        $("input[name='freckle_experience']:checked").each(function (i) {
            var freckle_val = $(this).val();
            if (freckle_val == null || freckle_val == undefined || freckle_val == "") {
                alert('你未选择祛斑经历，请选择！')
                return false;
            } else {
                if (check_freckle_experience.length > 0) {
                    check_freckle_experience = check_freckle_experience + ',' + freckle_val;
                } else {
                    check_freckle_experience = freckle_val;
                }
            }
        });
        //色斑类型
        $("input[name='stains_cate']:checked").each(function (i) {
            var stains_val = $(this).val();
            if (stains_val == null || stains_val == undefined || stains_val == "") {
                alert('你未选择色斑类型，请选择！')
                return false;
            } else {
                if (check_stains_cate.length > 0) {
                    check_stains_cate = check_stains_cate + ',' + stains_val;
                } else {
                    check_stains_cate = stains_val;
                }
            }
        });

        //服务添加
        var sserinfo = new Array();
        $(".confim_info").each(function(i){
            var serinfo = new Object();//放外层，（地址）赋值会被覆盖
            $(".confim_info").eq(i).find('li').each(function(j){
                var temp=$(".confim_info").eq(i).find('li').eq(j);
                var lival = temp.text();
                if(temp.attr('class') != 'null' &&  temp.attr('class') != undefined && temp.attr('class') != ""){
                    if(temp.attr('class') == 'ser_sign'){
                        var cname = temp.attr('class');
                        serinfo[cname] = temp.find('img').attr('src');
                        sserinfo[i] =  serinfo;
                    }else{
                        var cname = temp.attr('class');
                        serinfo[cname] = lival;
                        sserinfo[i] =  serinfo;
                    }
                }
            });
        });


        $.ajax({
            url: '{$Think.const.DQURL}index/customers/save_server',// 获取自己系统后台用户信息接口
            data: {"customers":customers,"customer_sign":customer_sign,"cussrc":cussrc,"dean_sign":dean_sign,
                "sserinfo": sserinfo,"skin_cate":check_skin_cate,"health":check_health,
                "freckle_experience":check_freckle_experience,"stains_cate":check_stains_cate,'addinfos':addinfo},
            type: "POST",
            dataType: "json",
            success: function (data) {
                if (data) {
                    var data = JSON.parse(data);
                    if (data.code == "200") { //判断返回值，这里根据的业务内容可做调整
                        $(e).removeAttr('disabled');
                        alert(data.msg);
                        // close_open();
                         window.location.href='{$Think.const.DQURL}index/customers';
                    } else {
                        alert(data.msg);
                        $(e).removeAttr('disabled');
                        return false;
                    }
                }
            },
            error: function (data) {
                $(e).removeAttr('disabled');
                console.log(data.message);
            }
        });
        return false;
    }
</script>
<script type="text/javascript">

    //上传封面
    //document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
    var clipArea = new bjj.PhotoClip("#clipArea", {
        size: [350, 362],// 截取框的宽和高组成的数组。默认值为[260,260]
        outputSize: [350, 362], // 输出图像的宽和高组成的数组。默认值为[0,0]，表示输出图像原始大小
        //outputType: "jpg", // 指定输出图片的类型，可选 "jpg" 和 "png" 两种种类型，默认为 "jpg"
        file: "#file", // 上传图片的<input type="file">控件的选择器或者DOM对象
        view: "#view", // 显示截取后图像的容器的选择器或者DOM对象
        ok: "#clipBtn", // 确认截图按钮的选择器或者DOM对象
        loadStart: function () {
            // 开始加载的回调函数。this指向 fileReader 对象，并将正在加载的 file 对象作为参数传入
            $('.cover-wrap').fadeIn();
            console.log("照片读取中");
        },
        loadComplete: function () {
            // 加载完成的回调函数。this指向图片对象，并将图片地址作为参数传入
            console.log("照片读取完成");
        },
        //loadError: function(event) {}, // 加载失败的回调函数。this指向 fileReader 对象，并将错误事件的 event 对象作为参数传入
        clipFinish: function (dataURL) {
            // 裁剪完成的回调函数。this指向图片对象，会将裁剪出的图像数据DataURL作为参数传入
            $('.cover-wrap').fadeOut();
            $('#view').css('background-size', '100% 100%');
            console.log(dataURL);
        }
    });
    //clipArea.destroy();
</script>
<script src="{$Think.const.JS_URL}searchSelect.js"></script>
{include file="template/footer.html"}
</body>
</html>