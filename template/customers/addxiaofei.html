<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>苗博士_添加消费</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="{$Think.const.STATIC_URL}lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="{$Think.const.STATIC_URL}lib/font-awesome/css/font-awesome.css">
    <script src="{$Think.const.STATIC_URL}lib/jquery-1.11.1.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}theme.css">
    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}premium.css">
    <script src="{$Think.const.STATIC_URL}layer/layer.js"></script>

    <script src="{$Think.const.STATIC_URL}plugins/cover_js/iscroll-zoom.js" type="text/javascript" charset="utf-8"></script>
    <script src="{$Think.const.STATIC_URL}plugins/cover_js/hammer.js" type="text/javascript" charset="utf-8"></script>
    <script src="{$Think.const.STATIC_URL}plugins/cover_js/lrz.all.bundle.js" type="text/javascript" charset="utf-8"></script>
    <script src="{$Think.const.STATIC_URL}plugins/cover_js/jquery.photoClip.min.js" type="text/javascript"
            charset="utf-8"></script>
</head>
<body>
<style>
    .c {
        clear: both;
    }

    .base_base {
        width: 90%;
        margin: 0 auto;
        font-size: 16px;
        font-weight: 500;
        color: #333;
    }

    .mbs_header .mbs_title {
        font-size: 28px;
        font-weight: 500;
        text-align: center;
        letter-spacing: 1px;
        color: #333;
    }

    .mbs_header .mbs_no {
        font-size: 18px;
        font-weight: 500;
        text-align: left;
        color: #333;
    }

    .base_info {
        font-size: 18px;
        color: #333;
        line-height: 1.5;
    }

    .base_info input, .solution input, .sign input, .if_did input {
        border: none;
        width: 35px;
        outline: none;
        margin-bottom: 3px;
    }

    .base_info input:focus, .solution input:focus, .sign input:focus, .if_did input:focus {
        outline: none;
        border-color: #ccc;
        box-shadow: 0 0 10px #ccc;
    }

    .if_did .wz_detail:focus, .if_did .surgery_detail:focus {
        width: 200px;
        outline: none;
        border-color: #ccc;
        box-shadow: 0 0 10px #ccc;
    }

    .base_info .if_marry input:focus, .if_did input:focus, .source_from input:focus {
        box-shadow: none;
        background: #fff;
    }

    .base_info p {
        text-align: left;
    }

    .base_info em, .solution em, .sign em {
        margin: 0 2px;
        font-style: normal;
    }

    .base_info .base_phone {
        padding-left: 30px;
    }
    .base_info .base_phone input {
        width: 250px;
    }

    .base_info .base_job input {
        width: 200px;
    }

    .pifu_base .pifu_right img {
        height: 257px;
        width: auto;
        margin-left: 5px;
    }

    .skin_des .fu_select .skin_select em {
        margin: 0 2px;
        font-style: normal;
    }

    .fu_select label {
        margin-top: 3px;
        margin-bottom: 3px;
    }

    .sign_quren img {
        height: 30px;
        width: 200px;
        vertical-align: middle
    }

    ul, li {
        padding: 0;
        margin: 0;
        list-style: none
    }

    .service_record ul {
        width: 100%;
        clear: both;
    }

    .service_record ul li {
        overflow: hidden;
        width: 18%;
        float: left;
        height: 30px;
        margin: 3px 0;
        line-height: 30px;
    }

    .service_record ul li input {
        width: 80%;
        margin: 0 auto;

    }

    .service_record ul .creat_time {
        height: 40px;
        width: 15%;
        font-size: 16px;
        text-align: center;
    }

    .service_record ul .server_demo {
        height: 40px;
        width: 18%;
    }

    .service_record ul .server_detail {
        height: 40px;
        width: 25%;
    }

    .service_record ul .server_pro {
        height: 40px;
        width: 20%;

    }

    .service_record ul .server_sign {
        height: 40px;
        width: 13%;
    }


    .service_record ul li input {
        border: 1px solid #ccc;
        height: 36px;
        width: 98%;
        outline: none;
        margin-bottom: 3px;
        font-size: 16px;
    }

    .service_record ul li input:focus {
        outline: none;
        border-color: #ccc;
        box-shadow: 0 0 10px #ccc;
    }

    .service_record ul .cazuo {
        width: 8%;
        line-height: 40px;
    }

    .service_record ul .cazuo span {
        height: 40px;
        font-size: 16px;
        margin-left: 9%;
        padding: 0 10%;
    }

    .service_record ul .cazuo .add_service {
        width: 40%;
        background: #ccc;
        color: #333;
        cursor: pointer;
    }

    .service_record ul .cazuo .ok_service {
        padding: 0 5px;
        background: #3c8a3c;
        color: #ccc;
        cursor: pointer;
    }

    .confim_info .del_server {
        padding: 0 6px;
        background: #ccc;
        color: #333;
        cursor: pointer;
    }

    .content {
        margin-left: 0px;
    }

    .base_base .base_left {
        float: left;
        with: 48%;
    }

    .base_base .base_right {
        float: right;
        with: 48%;
    }

    .base_base .base_input {
        line-height: 1.5;

    }

    .base_base .base_input .base_input_right input, .base_base .base_input .base_input_left input, .base_base .base_input select {
        height: 25px;
        border: 1px solid #ccc;
        outline: none;
        margin-bottom: 3px;
        font-size: 16px;
    }

    .base_base .base_input .base_input_right input:focus, .base_base .base_input .base_input_left input:focus, .base_base .base_input select:focus {
        outline: none;
        border-color: #ccc;
        box-shadow: 0 0 10px #ccc;
    }

    .base_base .base_input em {
        letter-spacing: 2px;
        font-style: normal;
    }

    .base_base .m10 {
        margin-left: 10px;
    }

    .base_input_left, .base_radio_left {
        width: 50%;
        float: left;
        min-width: 320px;
    }

    .base_input_right {
        width: 50%;
        float: left;
        min-width: 320px;
    }

    .pt10 {
        padding-top: 10px;
    }

    .base_base .project {
        line-height: 1.5;
        padding-top: 5px;
    }

    .base_base .project p {
        float: left;
        margin-right: 5px;
        padding: 2px 2px 2px 0px;
    }

    .base_base .project span {
        margin: 0 5px 0 5px;
        font-size: 14px;
        color: #666;
    }

    .base_base .project i {
        font-style: normal;
        margin-right: 8px;
        border: 1px solid #ccc;
        padding: 0px 4px;
        margin-left: 2px;
        font-size: 12px;
        background: #ccc;
        color: #333;
        cursor: pointer;
    }

    .base_base .xmxz {
        background: #ccc;
        color: #282f41;
        font-size: 16px;
        padding: 2px 5px;
        letter-spacing: 1px;
    }

    .demochk {
        float: left;
        margin-left: 2px;
        padding: 2px 5px 2px 0;
    }

    .demochk span {
        position: relative;
        top: -2px;
    }

</style>
<div class="content" id="ddd">

    <div class="base_base base_info">
        <p>客户信息</p>
        <div class="">
       <span><em>姓名：</em><input style="width: 100px" type="text" name="name" id="user_name" value="{$cusinfo.name}"
                                readonly>
       <input style="width: 100px" type="hidden" name="name" id="user_id" value="{$cusinfo.id}"
              readonly></span>
            <span><em>性别：</em>
                <input style="text-align: center" type="text" name="name" id="user_sex"
                       {if condition="(isset($cusinfo) && $cusinfo.sex == 1)" } value="男" readonly
                       {elseif condition="$cusinfo.sex == 2"/} value="女" readonly {/if} ></span>
            <span class="base_phone" >联系方式：<input style="" type="text" name="phone" id="user_phone" value="{$cusinfo.phone}"
                                              readonly></span>
        </div>
    </div>
    <div class="base_base c">
        <hr>
        <div class="base_input">
            <div class="base_radio_left">
            <span><em>是否本店支付：</em>
                <input style="text-align: center" type="radio" name="if_local" value="1" checked
                       onchange="iflocal(this)">&nbsp;是&nbsp;
                <input style="text-align: center" type="radio" name="if_local" value="2" onchange="iflocal(this)">&nbsp;否&nbsp;
            </span>
            </div>
        </div>
        <div class="base_input c pt10">
            <div class="base_input_right">
                <span class="" style="position: relative"><em style="letter-spacing: 1px">服务门店：</em> </span>
                {if condition="($usign==2)"}
                <input class="chain_input" type="text" value="{$cin.cname}" sid="{$cin.cid}" readonly>
                {/if}
                {if condition="($usign==1)"}
                <select style="width: 187px;height:25px;" class="serchain_select" name="serchain_id" autocomplete="off"
                        onchange="changechain(this)">

                    <option value="0" dd="" es="" ss=""  taxrate="">请选择门店</option>
                    {foreach $chain as $k }
                    <option value="{$k.id}" dd="" es="" ss="{$k.id}" taxrate="" {if condition="$cusinfo.chain_id==$k.id" }selected {/if} >{$k.name}</option>
                    {/foreach}
                </select>
                {/if}

            </div>
            <div class="base_input_right xiaofeichain" style="display: none">
                <span class="" style="position: relative"><em style="letter-spacing: 1px">消费门店：</em>  </span>

                <select style="width: 187px;height:25px;"
                        class="xfchain_select" name="xfchain_id" autocomplete="off">
                    <option value="0" dd="" es="" ss="" taxrate="">请选择消费门店</option>
                    {foreach $chain as $k }
                    <option value="{$k.id}" dd="" es="" ss="{$k.id}" taxrate="">{$k.name}</option>
                    {/foreach}
                </select>

            </div>
        </div>
        <div class="base_input pt10 c">
            <!--            <div class="base_radio_left">-->
            <!--            <span><em>是否选择套餐：</em>-->
            <!--                <input style="text-align: center" type="radio" name="iftc" value="1" checked onchange="ifpak(this)">&nbsp;是&nbsp;-->
            <!--                <input style="text-align: center" type="radio" name="iftc" value="2" onchange="ifpak(this)">&nbsp;否&nbsp;-->
            <!--            </span>-->
            <!--            </div>-->
            <div class="base_input_right">
                <span class="tcxz" style="position: relative"><em style="letter-spacing: 1px">诊疗项目：</em>
                   <select style="width: 187px;height:25px;" class="packageselect" name="wz_detail" autocomplete="off">
                        {foreach $package as $k }
                        <option value="{$k.package_id}" dd="" es="" ss="{$k.package_id}"
                             taxrate="">{$k.package_name}</option>
                        {/foreach}
                        <option value="-1" dd="" es="" ss="" >退款</option>
                    </select>
                </span>
                <!--                <span class="xmxz" style="display: none" onclick="xzxm();">自选项目</span>-->
            </div>
            <div class="project c" style="display: none">

            </div>
        </div>
        <div class="base_input pt10 c">
            <div class="base_input_left">
                <span class="jishi" style="position: relative"><em style="letter-spacing: 5px">治疗师：</em>  </span>
                <select style="width: 187px;height:25px;" class="jishiselect" name="jishi" autocomplete="off">
                    {foreach $jishi as $k }
                    <option value="{$k.id}" dd="" es="" ss="{$k.id}" {if condition="$cusinfo.server_id==$k.id"}selected {/if} taxrate="">{$k.name}</option>
                    {/foreach}
                </select>

            </div>
            <div class="base_input_right">
                <span class="qiantai"><em style="">前台接待：</em> </span>
                <select style="width: 187px;height:25px;" class="qiqantaiselect" name="reception" autocomplete="off">
                    {foreach $reception as $k }
                    <option value="{$k.id}" dd="" es="" ss="{$k.id}" taxrate="">{$k.name}</option>
                    {/foreach}
                </select>

            </div>
        </div>
        <div class="base_input pt10 c">
            <div class="base_input_left">
                <span class="fangshi" style=""><em style="letter-spacing: 1px">支付方式：</em>    </span>
                <select style="width: 210px;height:25px;" class="payway" name="wz_detail" autocomplete="off">
                    {foreach $payway as $k }
                    <option value="{$k.payway_id}" dd="" es="" ss="{$k.payway_id}"
                            taxrate="">{$k.payway_name}
                    </option>
                    {/foreach}
                </select>


            </div>
        </div>
<!--        <div class="base_input pt10 c">-->
<!--            <div class="base_input_left">-->
<!--               <span class="" style=""><em style="letter-spacing: 1px">额外消费：</em>-->
<!--                   <input class="chain_input" type="text" value="">-->
<!--               </span>-->
<!--            </div>-->
<!--        </div>-->
<!--        <div class="base_input pt10 c">-->
<!--            <div class="base_input_left">-->
<!--               <span class="" style=""><em style="letter-spacing: 12px">折扣：</em>-->
<!--                   <input class="chain_input" type="text" value="">-->
<!--               </span>-->
<!--            </div>-->
<!--            <div class="base_input_right">-->
<!--                <span class="" style=":"><em style="letter-spacing: 14px;">满减：</em>-->
<!--                   <input class="chain_input" type="text" value="">-->
<!--               </span>-->
<!--            </div>-->
<!--        </div>-->
        <div class="base_input pt10 c">
            <div class="base_input_left">
                <span class="" style=""><em style="letter-spacing: 1px">消费金额：</em> </span>
                 <input class="money_total" type="text" value="" />
            </div>
        </div>
        <div class="base_input pt10 c">
            <div class="base_radio_left">
            <span><em>是否结清：</em>
                <input style="text-align: center" type="radio" name="if_owe" value="1" checked
                       onchange="ifowe(this)">&nbsp;是&nbsp;
                <input style="text-align: center" type="radio" name="if_owe" value="2" onchange="ifowe(this)">&nbsp;否&nbsp;
            </span>
            </div>
            <div class="base_input_right owemoney" style="display: none;">
                <span class="" style=""><em style="letter-spacing: 2px">欠款金额：</em> </span>
                <input class="owe_money" type="text" value="" sid="" />

            </div>
        </div>
        <div class="base_input pt10 c">
            <div class="base_input_left">
                <span class="" style=" "><em style="">备注：</em>
                   <textarea style="border:1px solid #ccc;border-radius:5px;background-color:rgba(241,241,241,.98);width: 355px;height: 100px;padding: 10px;resize: none;font-size: 14px" placeholder="消费备注" class="xfbeizhu">

                   </textarea>
               </span>
            </div>
        </div>
        <div class="base_input pt10 c">
            <p style="text-align:center;background: #29b578; width: 9rem; height: 3rem; line-height: 3rem; color: #fff;  letter-spacing: 1px;margin-top: 1rem;">
                <sapn style="cursor: pointer;" onclick="confirmsub(this);">确定</sapn>
            </p>
        </div>
        </p>
    </div>


</div>
<div class="layui-layer-shade" style="z-index:19891019; background:url(); display:none;" id="xiugaiyynn">
    <div class="layui-layer layui-anim layui-layer-page layer-ext-moon"
         style="z-index: 19891020; width:310px; height:250px; left:50%; margin-left:-155px;">
        <div class="layui-layer-title" style="cursor: move;">选择项目</div>
        <div class="layui-layer-content">
            <div class="animated">
                <!--                <form action="__URL__/managexf" method="post" class="form-horizontal">-->
                <div class="ibox float-e-margins" style="margin-bottom:0px;">
                    <div class="ibox-content">
                        <div class="input-group m-b" style="margin-bottom:5px;">
                            <div class="demochk">
                                <span>项目一</span><input type="checkbox" name="demo[]" class="ck_1" value="1">
                            </div>
                            <div class="demochk">
                                <span>项目二</span><input type="checkbox" name="demo[]" class="ck_2" value="2">
                            </div>
                            <div class="demochk">
                                <span>项目三</span><input type="checkbox" name="demo[]" class="ck_3" value="3">
                            </div>
                            <div class="demochk">
                                <span>项目四</span><input type="checkbox" name="demo[]" class="ck_4" value="4">
                            </div>
                            <div class="demochk">
                                <span>项目五</span><input type="checkbox" name="demo[]" class="ck_5" value="5">
                            </div>
                            <div class="demochk">
                                <span>项目六</span><input type="checkbox" name="demo[]" class="ck_6" value="6">
                            </div>
                            <div class="demochk">
                                <span>项目七</span><input type="checkbox" name="demo[]" class="ck_7" value="7">
                            </div>
                            <div class="demochk">
                                <span>项目八</span><input type="checkbox" name="demo[]" class="ck_8" value="8">
                            </div>
                            <div class="demochk">
                                <span>项目九</span><input type="checkbox" name="demo[]" class="ck_9" value="9">
                            </div>
                            <div class="demochk">
                                <span>项目十</span><input type="checkbox" name="demo[]" class="ck_10" value="10">
                            </div>
                            <div class="demochk">
                                <span>项目十一</span><input type="checkbox" name="demo[]" class="ck_11" value="11">
                            </div>


                        </div>
                        <div class="form-group" align="center" style="margin-bottom:5px;">
                            <p style="background: #29b578; width: 9rem; height: 3rem; line-height: 3rem; color: #fff;  letter-spacing: 1px;margin-top: 1rem;">
                                <sapn style="cursor: pointer;" onclick="confirmpro();">确定</sapn>
                            </p>
                        </div>
                    </div>
                </div>
                <!--                </form>-->
            </div>
        </div>
        <span class="layui-layer-setwin" id="xiugaiyyxx"><a class="layui-layer-ico layui-layer-close layui-layer-close1"
                                                            href="javascript:;"></a></span>
    </div>
</div>
<script language="javascript" src="{$Think.const.JS_URL}jquery.jqprint-0.3.js"></script>
<script>
    $('#xiugaiyyxx').on('click', function () {
        $('#xiugaiyynn').hide()
    });
    //
    // $("input[name='if_local']").on('click', function () {
    //     var ss = ' <select style="width: 210px;height:25px;" class="payway" name="wz_detail" autocomplete="off">';
    //     var iflocal = parseInt($(this).val());
    //     $('.payway').remove();
    //     //借店支付
    //     $.ajax({
    //         url: '/index.php/index/customers/payway',// 获取自己系统后台用户信息接口
    //         data: {'type': iflocal},
    //         type: "POST",
    //         dataType: "json",
    //         success: function (data) {
    //             if (data) {
    //                 var data = JSON.parse(data);
    //                 // console.log(data);return  false;
    //                 if (data.code == "200") { //判断返回值，这里根据的业务内容可做调整
    //                     var payway = data.payway;
    //                     for(var i in payway){
    //                         ss += '  <option value="'+payway[i]['payway_name']+'" dd="" es="" ss="'+payway[i]['payway_name']+'" taxrate="">'+payway[i]['payway_name']+'</option>'
    //                     }
    //                     ss += '</select>';
    //                     console.log(ss);
    //                     $('.fangshi').after(ss);
    //                 } else {
    //                     alert(data.msg);
    //                     $(e).removeAttr('disabled');
    //                     return false;
    //                 }
    //             }
    //         },
    //         error: function (data) {
    //             $(e).removeAttr('disabled');
    //             console.log(data.message);
    //         }
    //     });
    // })
    function changechain(e) {
        var chainid = parseInt($(e).val());
        $('.jishiselect').remove();
        $('.qiqantaiselect').remove();
        $('.packageselect').remove();
        //jishi jishiselect
        var js = '<select style="width: 187px;height:25px;" class="jishiselect" name="jishi" autocomplete="off">';
        //qiantai qiantaiselect
        var pk = '<select style="width: 187px;height:25px;" class="packageselect" name="reception" autocomplete="off">';
        //tcxz packageselect
        var cp = '<select style="width: 187px;height:25px;" class="qiqantaiselect" name="wz_detail" autocomplete="off" >';
        $.ajax({
            url: '{$Think.const.DQURL}index/customers/changechain',// 获取自己系统后台用户信息接口
            data: {'chainid': chainid},
            type: "POST",
            dataType: "json",
            success: function (data) {
                if (data) {
                    var data = JSON.parse(data);
                    // console.log(data);return  false;
                    if (data.code == "200") { //判断返回值，这里根据的业务内容可做调整
                        var jishi = data.jishi;
                        for (var i in jishi) {
                            js += '  <option value="' + jishi[i]['id'] + '" dd="" es="" ss="' + jishi[i]['id'] + '" taxrate="">' + jishi[i]['name'] + '</option>'
                        }
                        js += '</select>';
                        $('.jishi').after(js);

                        var reception = data.reception;
                        for (var i in reception) {
                            cp += '  <option value="' + reception[i]['id'] + '" dd="" es="" ss="' + reception[i]['id'] + '" taxrate="">' + reception[i]['name'] + '</option>'
                        }
                        cp += '</select>';
                        $('.qiantai').after(cp);

                        var package = data.package;
                        for (var i in package) {
                            pk += '  <option value="' + package[i]['package_id'] + '" dd="" es="" ss="' + package[i]['package_id'] + '" taxrate="">' + package[i]['package_name'] + '</option>'
                        }
                        pk += '   <option value="-1" dd="" es="" ss="" >退款</option></select>';
                        $('.tcxz').after(pk);

                    } else {
                        alert(data.msg);
                        return false;
                    }
                }
            },
            error: function (data) {
                $(e).removeAttr('disabled');
                console.log(data.message);
            }
        });
    }

    function deldd(e) {
        $(e).parent().parent().remove();
    }

    function confirmpro() {
        ss = ''
        $("input[name='demo[]']:checked").each(function () {
            var id = parseInt($(this).val());
            var con = $(this).parent().text();
            ss += '<p did="' + id + '"><span>' + con + '<i onclick="deldd(this);">x</i></span></p>'
        });
        $('.project').html('');
        $('.project').html(ss);
        $('#xiugaiyynn').hide()


    }

    function xzxm() {
        var dids = new Array();
        var did = 0;
        $(".project p").each(function () {
            did = parseInt($(this).attr('did'));
            if (did > 0) {
                dids.push(did);
            }
        });
        $('.demochk').each(function () {
            var xzdid = parseInt($(this).find("input[name='demo[]']").val());
            if ($.inArray(xzdid, dids) != -1) {
                $(this).find("input[name='demo[]']").attr("checked", true);
            }

        })

        $('#xiugaiyynn').show();

    }

    function iflocal(e) {
        var iflocal = parseInt($(e).val());
        if (iflocal == 1) {
            //本店支付
            $('.xiaofeichain').css('display', 'none');

        } else if (iflocal == 2) {
            $('.xiaofeichain').css('display', '');
        }
        var ss = ' <select style="width: 210px;height:25px;" class="payway" name="wz_detail" autocomplete="off">';
        $('.payway').remove();
        //借店支付
        $.ajax({
            url: '{$Think.const.DQURL}index/customers/payway',// 获取自己系统后台用户信息接口
            data: {'type': iflocal},
            type: "POST",
            dataType: "json",
            success: function (data) {
                if (data) {
                    var data = JSON.parse(data);
                    // console.log(data);return  false;
                    if (data.code == "200") { //判断返回值，这里根据的业务内容可做调整
                        var payway = data.payway;
                        for (var i in payway) {
                            ss += '  <option value="' + payway[i]['payway_id'] + '" dd="" es="" ss="' + payway[i]['payway_id'] + '" taxrate="">' + payway[i]['payway_name'] + '</option>'
                        }
                        ss += '</select>';
                        $('.fangshi').after(ss);
                    } else {
                        alert(data.msg);
                        return false;
                    }
                }
            },
            error: function (data) {
                $(e).removeAttr('disabled');
                console.log(data.message);
            }
        });
    }

    function ifowe(e) {
        var owe = parseInt($(e).val());
        if(owe == 1){
            $(e).parent().parent().parent().find('.owemoney').css('display','none');
        }else if(owe == 2){
            $(e).parent().parent().parent().find('.owemoney').css('display','');
        }
    }

    function ifpak(e) {
        var iftc = parseInt($(e).val());
        if (iftc == 1) {
            //选择套餐
            $('.xmxz').css('display', 'none');
            $('.tcxz').css('display', '');
            $('.project').css('display', 'none');
        } else if (iftc == 2) {
            //选择项目
            $('.xmxz').css('display', '');
            $('.project').css('display', '');
            $('.tcxz').css('display', 'none');
        }
    }

    function confirmsub(e) {
        // $("#ddd").jqprint();
        var xfinfo = '';
        var customerid = parseInt($('#user_id').val());
        var customername = $('#user_name').val();
        var jishiid = parseInt($('.jishiselect').val());
        var jishiname = $('.jishiselect').find("option:selected").text();
        var receptionid = parseInt($('.qiqantaiselect').val());
        var serchainid;
        var paywayid = $('.payway').val();
        var moneytotal = $('.money_total').val();

        var xfbeizhu = $('.xfbeizhu').val();
        var owemoney;
        var packageid = parseInt($('.packageselect').val());
        if(!(customerid>0)){
            alert('客户信息不存在');
            return  false;
        }

        //非1权限选择
        var norchainid= parseInt($('.chain_input').attr('sid'));

        //1权限选择
        var supchainid = parseInt($('.serchain_select').val());
        if(norchainid > 0){
            serchainid = norchainid;
        }

        if(supchainid > 0){
            serchainid = supchainid;
        }
        var xfchainid = parseInt($('.xfchain_select').val());
        var iflocal = parseInt($("input[name='if_local']:checked").val());
        var clean = parseInt($("input[name='if_owe']:checked").val());
        if(!(serchainid>0)){
            alert("请选择服务门店");
            return false;
        }
        if(!(jishiid>0)){
            alert('请选择治疗师');
            return  false;
        }
        if(!(customerid>0)){
            alert('请选择前台接待');
            return  false;
        }

        if (iflocal == 2){
            //借店支付
            if(!(xfchainid>0)){
                alert("请选择消费门店");
                return  false;
            }
        }
        var regu = /^[0-9]+\.?[0-9]*$/;
        if (moneytotal != "") {
            if (!regu.test(moneytotal)) {
                alert("请输入正确的数字");
                $('.money_total').val('');
                $('.money_total').focus();
                return false;
            }
        }else {
            alert("请输入消费金额")
            return  false;
        }

        if(clean == 1){
            owemoney = 0;
        }else if(clean == 2){
            owemoney = $('.owe_money').val();
            if (!regu.test(owemoney)) {
                alert("请输入正确的数字");
                return false;
            }
        }
        xfinfo += 'customer_id*' + customerid +',';
        xfinfo += 'customer_name*' + customername +',';
        xfinfo += 'jishi_id*' + jishiid +',';
        xfinfo += 'jishi_name*' + jishiname +',';
        xfinfo += 'reception_id*' + receptionid +',';
        xfinfo += 'if_local*' + iflocal +',';
       if(iflocal == 1){
           xfinfo += 'serchain_id*' + serchainid +',';
           xfinfo += 'xfchain_id*' + serchainid +',';
       }else if(iflocal == 2){
           xfinfo += 'serchain_id*' + serchainid +',';
           xfinfo += 'xfchain_id*' + xfchainid +',';
       }
        xfinfo += 'total_money*' + moneytotal +',';
        xfinfo += 'xfbeizhu*' + xfbeizhu +',';
        xfinfo += 'payway_id*' + paywayid +',';
        xfinfo += 'clean*' + clean +',';
        xfinfo += 'owe*' + owemoney +',';
        xfinfo += 'package_id*' + packageid +',';
        $.ajax({
            url: '{$Think.const.DQURL}index/customers/savexiaofei',// 获取自己系统后台用户信息接口
            data: {'xfinfo': xfinfo},
            type: "POST",
            dataType: "json",
            success: function (data) {
                if (data) {
                    var data = JSON.parse(data);
                    // console.log(data);return  false;
                    if (data.code == "200") { //判断返回值，这里根据的业务内容可做调整
                        window.parent.location.reload();
                    } else {
                        alert(data.msg);
                        return false;
                    }
                }
            },
            error: function (data) {
                $(e).removeAttr('disabled');
                console.log(data.message);
            }
        });



    }

    function ser_peo_ok(e) {
        $(e).addClass('select_ser');
        // console.log($(e).attr('class'));
        layer.open({
            type: 2,
            title: '签名',
            maxmin: true,
            area: ['500px', '400px'],
            content: '/template/sign.html?sign=service'
        });

    }

    function if_show(e) {
        var attrval = parseInt($(e).val());
        // console.log(attrval);
        if (attrval == 1) {
            $('.sur_detail').css('display', 'block');
            // $(e).parent().parent().find('.surgery_detail').removeAttr('disabled');
        } else if (attrval == 2) {
            $('.sur_detail').css('display', 'none');
            // $(e).parent().parent().find('.surgery_detail').attr('disabled', 'disabled');
        }
    }

    $('.customer_sign_start .cus_sign_ok').on('click', function () {
        layer.open({
            type: 2,
            title: '签名',
            maxmin: true,
            area: ['500px', '400px'],
            content: '/template/sign.html?sign=cus'
        });
    });
    $('.dean_sign_start .dean_sign_ok').on('click', function () {
        layer.open({
            type: 2,
            title: '签名',
            maxmin: true,
            area: ['500px', '400px'],
            content: '/template/sign.html?sign=dean'
        });
    });


    function confirm_sub(e) {
        var customers = '';
        var addinfo = '';
        var cussrc = '';
        cussrc = $('#view').css("background-image").split("\"")[1];
        //
        var server_no = $('.mbs_no span').text().replace(/(^\s*)|(\s*$)/g, "");
        //客户信息延伸
        var customer_id = parseInt($('.mbs_no').attr('attruid'));
        var cus_job = $('#user_job').val().replace(/(^\s*)|(\s*$)/g, "");
        var is_marry = parseInt($('input[name="is_marry"]:checked').val());
        var if_huli = parseInt($('input[name="if_huli"]:checked').val());
        //是否微整
        var if_surgery = parseInt($('input[name="if_surgery"]:checked').val());
        //详情告知
        var sur_deyail = $('.surgery_detail').val().replace(/(^\s*)|(\s*$)/g, "");
        var solution = $('.ssolution').val().replace(/(^\s*)|(\s*$)/g, "");
        var use_product = $('.use_product').val().replace(/(^\s*)|(\s*$)/g, "");
        var customer_sign = $('.cus_sign_ok').attr('src').replace(/(^\s*)|(\s*$)/g, "");
        if (!customer_sign.length > 1) {
            alert('顾客签字不能为空！');
            return false;
        }
        var customer_name = $('#user_name').val().replace(/(^\s*)|(\s*$)/g, "");
        //技师名称
        var jishi = $('#selectInputClone').val().replace(/(^\s*)|(\s*$)/g, "");
        //技师id
        var jsid = parseInt($('.selectssss').val());

        if (customer_id > 0) {
            customers = 'customer_id*' + customer_id + ',';
        } else {
            alert('无效的客户信息！');
            return false;
        }
        if (jsid > 0) {
            customers = customers + 'server_id*' + jsid + ',';
        } else {
            alert('请分配技师！');
            return false;
        }
        if (jishi != null && jishi != undefined && jishi != "") {
            customers = customers + 'server_name*' + jishi + ',';
        }
        if (customer_name != null && customer_name != undefined && customer_name != "") {
            customers = customers + 'customer_name*' + customer_name + ','
        }
        if (server_no != null && server_no != undefined && server_no != "") {
            customers = customers + 'server_no*' + server_no + ','
        } else {
            alert('无效的单子！');
            return false;
        }

        if (is_marry > 0) {
            addinfo = 'cusismarry*' + is_marry + ',';
        } else {
            alert('请勾选是否已婚！');
            return false;
        }
        if (cus_job != null && cus_job != undefined && cus_job != "") {
            addinfo = addinfo + 'cusjob*' + cus_job + ','
        }
        if (if_surgery > 0) {
            customers = customers + 'micro_surgery*' + if_surgery + ',';
            if (if_surgery == 1 && sur_deyail != null && sur_deyail != undefined && sur_deyail != '') {
                customers = customers + 'surgery_detail*' + sur_deyail + ',';
            }
        } else {
            alert('请勾选是否微整！');
            return false;
        }

        if (if_huli > 0) {
            customers = customers + 'done_skincare*' + if_huli + ','
        } else {
            alert('请勾选护理信息！');
            return falsep;
        }

        if (solution != null && solution != undefined && solution != "") {
            customers = customers + 'solution*' + solution + ','
        } else {
            alert('请填写解决方案');
            return false;
        }
        if (use_product != null && use_product != undefined && use_product != "") {
            customers = customers + 'product*' + use_product + ','
        } else {
            alert('请填写产品');
            return false;
        }
        //客户状态评测信息
        var check_skin_cate = '';//皮肤类型
        var check_health = '';//身体状况 health_info
        var check_freckle_experience = '';//祛斑经历 freckle_experience
        var check_stains_cate = '';//色斑类型 stains_cate

        //皮肤类型
        $("input[name='skin_cate']:checked").each(function (i) {
            var my_val = $(this).val();
            if (my_val == null || my_val == undefined || my_val == "") {
                alert('你未选择皮肤类型，请选择！')
                return false;
            } else {
                if (check_skin_cate.length > 0) {
                    check_skin_cate = check_skin_cate + ',' + my_val;
                } else {
                    check_skin_cate = my_val;
                }
            }
        });
        //身体状况
        $("input[name='health_info']:checked").each(function (i) {
            var health_val = $(this).val();
            if (health_val == null || health_val == undefined || health_val == "") {
                alert('你未选择身体状况，请选择！')
                return false;
            } else {
                if (check_health.length > 0) {
                    check_health = check_health + ',' + health_val;
                } else {
                    check_health = health_val;
                }
            }
        });
        //祛斑经历
        $("input[name='freckle_experience']:checked").each(function (i) {
            var freckle_val = $(this).val();
            if (freckle_val == null || freckle_val == undefined || freckle_val == "") {
                alert('你未选择祛斑经历，请选择！')
                return false;
            } else {
                if (check_freckle_experience.length > 0) {
                    check_freckle_experience = check_freckle_experience + ',' + freckle_val;
                } else {
                    check_freckle_experience = freckle_val;
                }
            }
        });
        //色斑类型
        $("input[name='stains_cate']:checked").each(function (i) {
            var stains_val = $(this).val();
            if (stains_val == null || stains_val == undefined || stains_val == "") {
                alert('你未选择色斑类型，请选择！')
                return false;
            } else {
                if (check_stains_cate.length > 0) {
                    check_stains_cate = check_stains_cate + ',' + stains_val;
                } else {
                    check_stains_cate = stains_val;
                }
            }
        });

        //服务添加
        var sserinfo = new Array();
        $(".confim_info").each(function (i) {
            var serinfo = new Object();//放外层，（地址）赋值会被覆盖
            $(".confim_info").eq(i).find('li').each(function (j) {
                var temp = $(".confim_info").eq(i).find('li').eq(j);
                var lival = temp.text();
                if (temp.attr('class') != 'null' && temp.attr('class') != undefined && temp.attr('class') != "") {
                    if (temp.attr('class') == 'ser_sign') {
                        var cname = temp.attr('class');
                        serinfo[cname] = temp.find('img').attr('src');
                        sserinfo[i] = serinfo;
                    } else {
                        var cname = temp.attr('class');
                        serinfo[cname] = lival;
                        sserinfo[i] = serinfo;
                    }
                }
            });
        });


        $.ajax({
            url: '{$Think.const.DQURL}index/customers/save_server',// 获取自己系统后台用户信息接口
            data: {
                "customers": customers, "customer_sign": customer_sign, "cussrc": cussrc,
                "sserinfo": sserinfo, "skin_cate": check_skin_cate, "health": check_health,
                "freckle_experience": check_freckle_experience, "stains_cate": check_stains_cate, 'addinfo': addinfo
            },
            type: "POST",
            dataType: "json",
            success: function (data) {
                if (data) {
                    var data = JSON.parse(data);
                    if (data.code == "200") { //判断返回值，这里根据的业务内容可做调整
                        $(e).removeAttr('disabled');
                        // close_open();
                        window.parent.location.reload();
                    } else {
                        alert(data.msg);
                        $(e).removeAttr('disabled');
                        return false;
                    }
                }
            },
            error: function (data) {
                $(e).removeAttr('disabled');
                console.log(data.message);
            }
        });
        return false;
    }
</script>
<script src="{$Think.const.JS_URL}}searchSelect.js"></script>
</body>
</html>