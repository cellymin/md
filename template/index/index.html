<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Miaoboshi</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="{$Think.const.STATIC_URL}/lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="{$Think.const.STATIC_URL}lib/font-awesome/css/font-awesome.css">

    <script src="{$Think.const.STATIC_URL}lib/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="{$Think.const.STATIC_URL}layer/layer.js"></script>
    <script src="{$Think.const.STATIC_URL}lib/jQuery-Knob/js/jquery.knob.js" type="text/javascript"></script>
    <script src="{$Think.const.JS_URL}echarts.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            $(".knob").knob();
        });
    </script>


    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}theme.css">
    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}premium.css">
    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}commonindex.css">

</head>
<body class="theme-blue" style="">

<!-- Demo page code -->

<script type="text/javascript">
    $(function () {
        var match = document.cookie.match(new RegExp('color=([^;]+)'));
        if (match) var color = match[1];
        if (color) {
            $('body').removeClass(function (index, css) {
                return (css.match(/\btheme-\S+/g) || []).join(' ')
            })
            $('body').addClass('theme-' + color);
        }

        $('[data-popover="true"]').popover({html: true});

    });
</script>

<script type="text/javascript">
    $(function () {
        var uls = $('.sidebar-nav > ul > *').clone();
        uls.addClass('visible-xs');
        $('#main-menu').append(uls.clone());
    });
</script>

<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- Le fav and touch icons -->


<!--[if lt IE 7 ]>
<body class="ie ie6"> <![endif]-->
<!--[if IE 7 ]>
<body class="ie ie7 "> <![endif]-->
<!--[if IE 8 ]>
<body class="ie ie8 "> <![endif]-->
<!--[if IE 9 ]>
<body class="ie ie9 "> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->

<!--<![endif]-->

{include file="template/sidebar.html"}

<style>

    .row {
        margin-right: 0px;
        margin-left: 0px;
    }

    @media (min-width: 992px) {
        .col-md-3 {
            width: 25%;
        }
    }

    @media (min-width: 992px) {
        .col-md-3, .col-md-6 {
            float: left;
        }

        .col-md-3, .col-md-6, .col-sm-6 {
            position: relative;
            min-height: 1px;
            padding-right: 10px;
            padding-left: 10px;
        }
    }

    .sm-st {
        background: #fff;
        padding: 20px;
        -webkit-border-radius: 3px;
        -moz-border-radius: 3px;
        border-radius: 3px;
        margin-top: 20px;
        margin-bottom: 20px;
        margin-bottom: 20px;
        -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.05);
        box-shadow: 0 1px 0px rgba(0, 0, 0, 0.05);
    }

    .sm-st-icon {
        width: 60px;
        height: 60px;
        display: inline-block;
        line-height: 60px;
        text-align: center;
        font-size: 30px;
        background: #eee;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        float: left;
        margin-right: 10px;
        color: #fff;
    }

    .fa {
        display: inline-block;
        font: normal normal normal 14px/1 FontAwesome;
        font-size: inherit;
        text-rendering: auto;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .sm-st-info {
        font-size: 12px;
        padding-top: 2px;
    }

    .sm-st-info span {
        display: block;
        font-size: 24px;
        font-weight: 600;
    }

    .st-red {
        background: #F05050;
    }

    .st-violet {
        background-color: #7266ba;
    }

    .st-blue {
        background-color: #23b7e5;
    }

    .st-green {
        background-color: #4ECDC4;
    }

    .mdshuju td, .mdshuju th {
        border-top: 1px solid #ccc;
        border-left: 1px solid #ccc;
        border-right: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        vertical-align: middle;
        width: 16%;
    }

    .mdshuju .sjruz {
        width: 20%;
    }

</style>
<div class="content" style="background: #f3f8fb;">
    {include file="template/navbar.html"}
    <div class="sousuo"
         {if condition="(isset($sign) && $sign == '1' )" }
         {else/}style="display:none"{/if}>
    <form action="" method="get">
        <div class="form_sub">
            <!--                <div class="sousuo_form">-->
            <!--                    门店： <input type="text" name="chain_name">-->
            <!--                </div>-->
            <div class="sousuo_form">
                     <span>
                           <select style="" class="shichang" name="shichang" autocomplete="off"
                                   onchange="changechain(this);">
                                <option value="">请选择市场
                               </option>
                               {foreach $shichanglist as $k }
                               <option value="{$k.city}" {if
                                       condition="(!empty($Think.get.shichang) && $Think.get.shichang==$k.city)" }
                                       selected {/if}>{$k.city}
                               </option>
                               {/foreach}
                           </select>
                     </span>
            </div>
            <div class="sousuo_form">
                     <span>
                           <select style="" class="chain_id" name="chain_id" autocomplete="off">
                                <option value="">请选择门店
                               </option>
                               {foreach $chain as $k }
                               <option value="{$k.id}" {if
                                       condition="(!empty($Think.get.chain_id) && $Think.get.chain_id == $k.id)" }
                                       selected {/if}>{$k.name}
                               </option>
                               {/foreach}
                           </select>
                     </span>
            </div>
            <!--                <div class="sousuo_form">-->
            <!--                    电话：<br/><input type="text" value="{$Think.get.phone}" name="phone" autocomplete="off">-->
            <!--                </div>-->
            <!--                <div class="sousuo_form">-->
            <!--                    订单编号：<br/><input type="text" value="{$Think.get.server_no}" name="server_no" autocomplete="off">-->
            <!--                </div>-->

            <div class="sousuo_form"
                 style="width: 80px;text-align: center;background: #39435C;color: #fff;cursor:pointer; ">
                <span class="suosou_btn" onclick="onconfirm();">搜索</span>
            </div>
            <!--                <div class="sousuo_form">-->
            <!--                    技师名称：<br/><input type="text" value="{$Think.get.server_name}" name="server_name" autocomplete="off">-->
            <!--                </div>-->
        </div>
    </form>
</div>
<div class="main-content" style="background: #f3f8fb;border: none">

    <div class="row" style="overflow: hidden;">
        <div style="border:1px solid #ddd;padding: 2px">
            <div class="echarts" id="echarts-bar-chart" style="width: 100%;height:418px;"></div>
        </div>

        <div style="border:1px solid #ddd;padding: 2px;overflow: hidden;margin-top: 5px">
            {if condition='isset($chainlist)'}
            {foreach $chainlist as $k}
            <div class="col-sm-6 mobile_left" style="min-width: 330px;overflow: hidden;margin: 8px 0px">
                <div class="panel panel-default" style="margin-bottom: 0px">
                    <table class="dataintable table" style="width: 100%">
                        <tr>
                            <th colspan="7"> {$k.name}</th>
                        </tr>
                        <tr>
                            <th style="width: 14%">日期</th>
                            <th>消费</th>
                            <th>欠费</th>
                            <th>退费</th>
                            <th>还款</th>
                            <th>借店支付</th>
                            <th>代店支付</th>
                        </tr>
                        <tr>
                            <td>今天</td>
                            <td>{$dayarr[$k.id]['xiaofei'] ?? '0'}</td>
                            <td>{$dayarr[$k.id]['owe'] ?? '0'}</td>
                            <td>{$dayarr[$k.id]['tuifei'] ?? '0'}</td>
                            <td>{$dayarr[$k.id]['huankuan'] ?? '0'}</td>
                            <td>{$dayarr[$k.id]['jiedian'] ?? '0'}</td>
                            <td>{$dayarr[$k.id]['daishou'] ?? '0'}</td>
                        </tr>
                        <tr>
                            <td>昨天</td>
                            <td>{$yestodayarr[$k.id]['xiaofei'] ?? '0'}</td>
                            <td>{$yestodayarr[$k.id]['owe'] ?? '0'}</td>
                            <td>{$yestodayarr[$k.id]['tuifei'] ?? '0'}</td>
                            <td>{$yestodayarr[$k.id]['huankuan'] ?? '0'}</td>
                            <td>{$yestodayarr[$k.id]['jiedian'] ?? '0'}</td>
                            <td>{$yestodayarr[$k.id]['daishou'] ?? '0'}</td>
                        </tr>
                        <tr>
                            <td>本月</td>
                            <td>{$montharr[$k.id]['xiaofei'] ?? '0'}</td>
                            <td>{$montharr[$k.id]['owe'] ?? '0'}</td>
                            <td>{$montharr[$k.id]['tuifei'] ?? '0'}</td>
                            <td>{$montharr[$k.id]['huankuan'] ?? '0'}</td>
                            <td>{$montharr[$k.id]['jiedian'] ?? '0'}</td>
                            <td>{$montharr[$k.id]['daishou'] ?? '0'}</td>
                        </tr>
                        <tr>
                            <td>上月</td>
                            <td>{$premontharr[$k.id]['xiaofei'] ?? '0'}</td>
                            <td>{$premontharr[$k.id]['owe'] ?? '0'}</td>
                            <td>{$premontharr[$k.id]['tuifei'] ?? '0'}</td>
                            <td>{$premontharr[$k.id]['huankuan'] ?? '0'}</td>
                            <td>{$premontharr[$k.id]['jiedian'] ?? '0'}</td>
                            <td>{$premontharr[$k.id]['daishou'] ?? '0'}</td>
                        </tr>

                    </table>
                </div>
            </div>
            {/foreach}
            {/if}
        </div>


    </div>

    <footer>
        <hr>

        <!-- Purchase a site license to remove this link from the footer: http://www.portnine.com/bootstrap-themes -->
        <p class="pull-right">A <a href="http://www.portnine.com/bootstrap-themes" target="_blank">Free Bootstrap
            Theme</a> by <a href="http://www.portnine.com" target="_blank">Portnine</a></p>
        <p>© 2014 <a href="http://www.portnine.com" target="_blank">Portnine</a></p>
    </footer>
</div>
</div>


{include file="template/footer.html"}
<script src="{$Think.const.STATIC_URL}/lib/echarts/echarts-all.js"></script>
<script>
    $(function () {
        var i = echarts.init(document.getElementById("echarts-bar-chart"));
        var q = {
            title: {
                subtext: {$date_riqi_s} - {$date_riqi_e}
            },
            tooltip: {
                trigger: "axis"
            },
            legend: {
                data: ['消费', '欠款', '退款']
            },
            grid: {
                x: {$left},
                x2: {$left},
                y2: 24,
                containLabel: true,
            },
            toolbox: {
                show: true,
                feature: {
                    mark: {show: false},
                    dataView: {show: false, readOnly: false},
                    magicType: {show: true, type: ['line', 'bar']},
                    restore: {show: false},
                    saveAsImage: {show: true}
                }
            },
            calculable: true,
            xAxis: [{
                type: "category",
                data: [{$date_riqi}]
            }],
            yAxis: [
                {
                    type: 'value',
                    show: true,
                    axisLabel: {
                        interval: 0,
                        roate: 0
                    }
                }
            ],
            series: [{
                name: "消费",
                type: "bar",
                data: [{$tenxiaofeiarr}],
                itemStyle: {
                    normal: {
                        label: {show: true}
                    }
                },
                markPoint: {
                    data: [{
                        type: "max",
                        name: "最大值"
                    },
                        {
                            type: "min",
                            name: "最小值"
                        }]
                },
                markLine: {
                    data: [{
                        type: "average",
                        name: "平均值"
                    }]
                }
            },
                {
                    name: "欠款",
                    type: "bar",
                    data: [{$tenowearr}],
                    itemStyle: {
                        normal: {
                            label: {show: true}
                        }
                    },
                    markPoint: {
                        data: [{
                            type: "max",
                            name: "最大值"
                        },
                            {
                                type: "min",
                                name: "最小值"
                            }]
                    },
                    markLine: {
                        data: [{
                            type: "average",
                            name: "平均值"
                        }]
                    }
                },
                {
                    name: "退款",
                    type: "bar",
                    data: [{$tentuifeiarr}],
                    itemStyle: {
                        normal: {
                            label: {show: true}
                        }
                    },
                    markPoint: {
                        data: [{
                            type: "max",
                            name: "最大值"
                        },
                            {
                                type: "min",
                                name: "最小值"
                            }]
                    },
                    markLine: {
                        data: [{
                            type: "average",
                            name: "平均值"
                        }]
                    }
                }]
        };
        i.setOption(q);
        window.onresize = i.resize;
    });

    function changechain(e) {
        var sc = $(e).val().replace(/(^\s*)|(\s*$)/g, "");
        $.ajax({
            url: '{$Think.const.DQURL}index/chain/changechain',
            data: {"sc": sc},
            type: "POST",
            dataType: "json",
            success: function (data) {
                if (data) {
                    var data = JSON.parse(data);
                    var ss = '  <option value="" >请选择门店</option>';

                    if (data.code == "200") { //判断返回值，这里根据的业务内容可做调整
                        var chainlist = data.chainlist;
                        for (var i in chainlist) {
                            ss += '  <option value="' + chainlist[i]['id'] + '">' + chainlist[i]['name'] + '</option>'
                        }
                        $('.chain_id').html('');
                        $('.chain_id').html(ss)

                    } else {
                        alert(data.msg);
                        return false;
                    }
                }
            },
            error: function (data) {
                console.log(data.message);
            }
        });
    }

    function onconfirm() {
        $('form').submit();
    }
</script>

</body>
</html>
