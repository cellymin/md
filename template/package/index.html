<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Miaoboshi</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="{$Think.const.STATIC_URL}lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="{$Think.const.STATIC_URL}lib/font-awesome/css/font-awesome.css">

    <script src="{$Think.const.STATIC_URL}lib/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="{$Think.const.STATIC_URL}layer/layer.js"></script>


    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}theme.css">
    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}premium.css">
    <link rel="stylesheet" type="text/css" href="{$Think.const.CSS_URL}mbscom.css">

</head>
<body class=" theme-blue" >

<!-- Demo page code -->

<script type="text/javascript">
    $(function() {
        var match = document.cookie.match(new RegExp('color=([^;]+)'));
        if(match) var color = match[1];
        if(color) {
            $('body').removeClass(function (index, css) {
                return (css.match (/\btheme-\S+/g) || []).join(' ')
            })
            $('body').addClass('theme-' + color);
        }

        $('[data-popover="true"]').popover({html: true});
    });
</script>
<style type="text/css">
    #line-chart {
        height:300px;
        width:800px;
        margin: 0px auto;
        margin-top: 1em;
    }
    .navbar-default .navbar-brand, .navbar-default .navbar-brand:hover {
        color: #fff;
    }
    .main-content{
        clear: both;
        width: 100%;
        margin: 0px auto ;
        border: 1px solid #ccc;
        border-radius: 2px;
        background: #fff;
    }
   .content .main-content .col-md-offset-1 {
       width: 100%;
       margin-left: 0px;
   }
    .main-content .page{
        margin-top: 0px;
        margin-block-start:0;
        margin-block-end: 0;
        margin-inline-start: 0px;
        margin-inline-end: 0px;
       text-align: left;
        margin-left: 15px;
        color: #333;
    }

</style>

<script type="text/javascript">
    $(function() {
        var uls = $('.sidebar-nav > ul > *').clone();
        uls.addClass('visible-xs');
        $('#main-menu').append(uls.clone());
    });
</script>

<!--Use of these features requires a premium license.-->
<!--See http://www.portnine.com/bootstrap-themes for details.-->
<!--After purchasing a premium license, the full source code will be available for download.-->



{include file="template/sidebar.html"}
<div class="content" style="background: #f3f8fb;">
    {include file="template/navbar.html"}
    <div class="main-content">
        <div class="row">

            <div class="col-md-10 col-md-offset-1">
                <div style="background: #e5e5e5 ;">
                    <div class="add_user" onclick="openedit();" style="float:right;cursor:pointer;font-size: 25px;width: 35px;height: 35px;margin-right:15px;line-height: 40px;text-align: center;margin-bottom: 2px">+</div>

<!--                    <div class="add_user" onclick="xzxm();" style="float: right;cursor: pointer;font-size: 15px;height: 30px;margin-right: 15px;line-height: 30px;text-align: center;background: #39435c;margin-top: 5px;padding: 0 9px;border-radius: 5px;color: #dedada">分配门店</div>-->

                    <h1 class="page">诊疗项目列表</h1>
                </div>
                <table class="dataintable table">
                    <thead>
                      <tr>
                        <th style="width: 50px;">#</th>
                        <th>名称</th>
                        <th>描述</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    {foreach $packagelist as $k }
                    <tr>
                        <td>
<!--                            <input style="margin-top: -2px;" type="checkbox" class="pakchk" name="package_id" value="{$k.package_id}">-->
                            {$k.package_id}
                        </td>
                        <td>{$k.package_name}
                        <td>{$k.package_desc}</td>
                        <td>
<!--                            <i class="fa fa-bell text-danger"></i>4 messages-->
                            <span class="text-sm" style=""> <a href="javascript:void(0)" attrid="{$k.package_id}" onclick="openedit(this);"
                                                                                data-toggle="modal"
                                                                                class="padding-right-small"><i
                                    class="fa fa-pencil "></i> 修改</a> <a
                                    href="javascript:void(0)" attrid="{$k.package_id}" onclick="deletepackage(this);"
                                    data-toggle="modal"><i class="fa fa-trash-o "></i> 删除</a></span></td>
                        </td>
                    </tr>
                    {/foreach}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!--<div class="layui-layer-shade" style="z-index:19891019; background:url(); display:none;" id="xiugaiyynn">-->
<!--    <div class="layui-layer layui-anim layui-layer-page layer-ext-moon"-->
<!--         style="z-index: 19891020; width:25rem; height:30rem; left:50%; margin-left:-155px;">-->
<!--        <div class="layui-layer-title" style="cursor: move;">选择门店</div>-->
<!--        <div class="layui-layer-content">-->
<!--            <div class="animated">-->
<!--                &lt;!&ndash;                <form action="__URL__/managexf" method="post" class="form-horizontal">&ndash;&gt;-->
<!--                <div class="ibox float-e-margins" style="margin-bottom:0px;">-->
<!--                    <div class="ibox-content">-->
<!--                        <div class="input-group m-b" style="margin-bottom:5px;">-->
<!--                            {foreach $chainlist as $k }-->
<!--                            <div class="demochk" style="height: 2rem; margin: 0.5rem;margin-left: 1.8rem">-->
<!--                                <input style="margin-top: -2px;" type="checkbox" name="chainchk[]" class="ck_1" value="{$k.id}"><span style="margin-left: 5px">{$k.name}</span>-->
<!--                            </div>-->
<!--                            {/foreach}-->
<!--                        </div>-->
<!--                        <div class="" align="center" style="margin-bottom:5px;">-->
<!--                            <p style="background: #29b578; width: 9rem; height: 3rem; line-height: 3rem; color: #fff;  letter-spacing: 1px;margin-top: 1rem;">-->
<!--                                <sapn style="cursor: pointer;" onclick="confirmpro();">确定</sapn>-->
<!--                            </p>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                &lt;!&ndash;                </form>&ndash;&gt;-->
<!--            </div>-->
<!--        </div>-->
<!--        <span class="layui-layer-setwin" id="xiugaiyyxx"><a class="layui-layer-ico layui-layer-close layui-layer-close1"-->
<!--                                                            href="javascript:;"></a></span>-->
<!--    </div>-->
<!--</div>-->
<script>
    function xzxm() {
        $('#xiugaiyynn').show();
    }
    $('#xiugaiyyxx').on('click', function () {
        $('#xiugaiyynn').hide()
    });
    function  confirmpro() {
        var packageid = new Array();
        var chainid = new Array();
        $("input[name='chainchk[]']:checked").each(function () {
            if(parseInt($(this).val()>0)){
                chainid.push(parseInt($(this).val()));
            }
        });
        $("input[name='package_id']:checked").each(function () {
            if(parseInt($(this).val()>0)){
                packageid.push(parseInt($(this).val()));
            }
        });
        if(!(packageid.length>0)){
            alert('请选择诊疗项目!');
            return  false;
        }
        if(!(chainid.length>0)){
            alert('请选择分配门店!');
            return  false;
        }
        $.ajax({
            url: '{$Think.const.DQURL}index/package/updatechain',// 获取自己系统后台用户信息接口
            data: {"packageid": packageid,'chainid':chainid},
            type: "POST",
            dataType: "json",
            success: function (data) {
                if (data) {
                    var data = JSON.parse(data);
                    if (data.code == "200") { //判断返回值，这里根据的业务内容可做调整
                        $(e).removeAttr('disabled');
                        window.location.reload();
                    } else {
                        alert(data.msg);
                        $(e).removeAttr('disabled');
                        return false;
                    }
                }
            },
            error: function (data) {
                $(e).removeAttr('disabled');
                console.log(data.message);
            }
        });
        $('#xiugaiyynn').hide()


    }
    function openedit(e) {
        var id = parseInt($(e).attr('attrid'));
        layer.ready(function () {
            layer.open({
                type: 2,
                title: '编辑项目',
                maxmin: true,
                area: ['50rem', '40rem'],
                content: '{$Think.const.DQURL}index/package/editpackage?id='+id
            });
        });
    }

    function deletepackage(e) {
        var id = parseInt($(e).attr('attrid'));
        var msg = "您真的确定要删除吗？\n\n请确认！";
        if (confirm(msg) == true) {
            $.ajax({
                url: '{$Think.const.DQURL}index/package/delete',// 获取自己系统后台用户信息接口
                data: {"id": id},
                type: "POST",
                dataType: "json",
                success: function (data) {
                    if (data) {
                        var data = JSON.parse(data);
                        if (data.code == "200") { //判断返回值，这里根据的业务内容可做调整
                            $(e).removeAttr('disabled');
                            window.location.reload();
                        } else {
                            alert(data.msg);
                            $(e).removeAttr('disabled');
                            return false;
                        }
                    }
                },
                error: function (data) {
                    $(e).removeAttr('disabled');
                    console.log(data.message);
                }
            });
        } else {
            return false;
        }


    }
</script>
{include file="template/footer.html"}